<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plant Monitoring Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">Plant Monitoring Dashboard</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Soil Moisture Card -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <h2 class="text-xl font-semibold mb-2">Soil Moisture</h2>
      <canvas id="moistureChart"></canvas>
    </div>

    <!-- Weather Card -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <h2 class="text-xl font-semibold mb-2">Air Data</h2>
      <canvas id="weatherChart"></canvas>
    </div>
  </div>
</div>

<script>
const apiKey = "EAG5JSOPGG6TUX2V";
const channelID = "3110199";

async function getData() {
    const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${apiKey}&results=20`);
    const data = await response.json();
    return data.feeds;
}

async function plotData() {
    const feeds = await getData();
    const labels = feeds.map(f => f.created_at).reverse();

    const moistureData = feeds.map(f => f.field1).reverse();
    const tempData = feeds.map(f => f.field2).reverse();
    const pressureData = feeds.map(f => f.field3).reverse();
    const humidityData = feeds.map(f => f.field4).reverse();

    new Chart(document.getElementById('moistureChart'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Soil Moisture', data: moistureData, borderColor: 'green', fill: false }] }
    });

    new Chart(document.getElementById('weatherChart'), {
        type: 'line',
        data: {
            labels,
            datasets: [
                { label: 'Temperature', data: tempData, borderColor: 'red', fill: false },
                { label: 'Pressure', data: pressureData, borderColor: 'blue', fill: false },
                { label: 'Humidity', data: humidityData, borderColor: 'orange', fill: false }
            ]
        }
    });
}

plotData();
</script>

</body>
</html>
